{{>/layout/main-header}}

<style>

</style>

<div class="container">
    <input id="postId" type="hidden" value="{{model.postId}}"/>
    <input id="pageOwnerId" type="hidden" value="1"/>
    <input id="my-loveId" type="hidden" value="1">


    <div class="my_post_detail_title">
        <h2>{{model.title}}</h2>
        <span>작성일 : {{model.createdAt}}</span>
    </div>
    <hr/>

    <div class="my_post_detail_content">
        {{{model.content}}}
    </div>

    <br><br>

    <div class="my_post_info_box d-flex">
        <div class="my_post_info">
            <i class="fa-solid fa-heart my_fake_like my_mr_sm_1" id="heart-1"></i>
            by <b>{{model.username}}</b> <span class="my_text_body_sm"></span>

            <!--            <i class="far fa-heart my_fake_un_like my_mr_sm_1" id="my-heart"></i>-->
            <!--            by <b>유저네임</b> <span class="my_text_body_sm">날짜</span>-->

        </div>
    </div>

    {{#model.isPostOwner}}
        <div class="my_mt_md_1">
            <a class="btn btn-outline-success" href="/post/update-form/{{model.postId}}">수정</a>
            <button id="btn-delete" class="btn btn-outline-danger">삭제</button>
        </div>
    {{/model.isPostOwner}}

    <br/>
    <hr>

    <!-- 댓글 -->
    <div class="card mt-3">
        <!-- 댓글등록 -->
        <div class="card-body">
            <form action="/reply/save" method="post">
                <input type="hidden" name="postId" value="{{model.postId}}">
                <textarea class="form-control" rows="2" name="comment"></textarea>
                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-outline-success mt-1">댓글등록</button>
                </div>
            </form>
        </div>

        <!-- 댓글목록 -->
        <div class="card-footer">
            <b>댓글리스트</b>
        </div>
        <div class="list-group">
            {{#model.replyDTOs}}
                <!-- 댓글아이템 -->
                <div id="showReplyUpdateForm-{{replyId}}" class="list-group-item d-flex justify-content-between align-items-center">
                    <div class="d-flex">
                        <div class="px-1 me-1 text-white rounded" style="margin-right: 10px; background-color: #1EB49F">
                            {{username}}
                        </div>
                        <div id="comment-{{replyId}}">{{comment}}</div>
                    </div>
                    {{#isReplyOwner}}
                        <div>
                            <button class="btn-sm btn-success replyUpdateBtn" id="reply-{{replyId}}">수정</button>
                            <form action="/board/delete" method="post" class="d-inline-block">
                                <button class="btn">🗑</button>
                            </form>
                        </div>
                    {{/isReplyOwner}}
                </div>
            {{/model.replyDTOs}}
        </div>
    </div>

    <br><br>

    <script>
        <!--        replyId 가져오기 -->
        $(".replyUpdateBtn").click(function () {
            let replyId = $(this).attr('id').replace('reply-', '');
            console.log("reply " + replyId);

            // let comment = $("#comment-" + replyId).data('reply');
            let comment = $("#comment-" + replyId).text();
            console.log("comment " + comment);

            let newElement = `<!--    댓글 수정 뷰 -->
                            <div id="newShowReplyUpdateForm-${replyId}" class="list-group-item justify-content-between align-items-center reply-wrapper">
                                <div class="d-flex">
                                    <div class="px-1 me-1 text-white rounded" style="margin-right: 10px; background-color: #1EB49F">
                                        유저네임
                                    </div>
                                    <textarea class="form-control" rows="3" name="comment" id="reply-comment-${replyId}"
                                         style="width: 100%; height: 80px;">${comment}</textarea>
                                </div>
                                <div class="d-flex justify-content-end" style="margin-top: 5px;">
                                    <a class="btn-sm btn-success" href="/reply/update/${replyId}">수정</a>
                                    <button class="btn-sm btn-danger replyUpdateCancelBtn" data-reply-id="${replyId}">취소</button>
                                </div>
                            </div>
                            <!--    댓글 수정 뷰 -->`;

            $("#showReplyUpdateForm-" + replyId).css('display', 'none');
            $("#showReplyUpdateForm-" + replyId).html(newElement);


        });

        // 취소 버튼 클릭 시 수정 폼 숨기기
        $(document).on("click", ".replyUpdateCancelBtn", function() {
            let replyId = $(this).data("reply-id");
            $("#showReplyUpdateForm-" + replyId).toggle();
        });


    </script>



    <!-- 댓글수정 -->
    <!--    <div class="card mt-3" id="reply-update-form">-->
    <!--        <div class="card-body">-->
    <!--            <form action="/reply/update" method="post">-->
    <!--                <input type="hidden" name="replyId" id="reply-id">-->
    <!--                <textarea class="form-control" rows="2" name="comment" id="reply-comment"></textarea>-->
    <!--                <div class="d-flex justify-content-end">-->
    <!--                    <button type="submit" class="btn btn-outline-success mt-1">댓글수정</button>-->
    <!--                </div>-->
    <!--            </form>-->
    <!--        </div>-->
    <!--    </div>-->


    <!-- 댓글 섹션 끝 -->

    <!--    <div class="my_livere">-->
    <!--        &lt;!&ndash; 라이브리 시티 설치 코드 &ndash;&gt;-->
    <!--        <div id="lv-container" data-id="city" data-uid="MTAyMC81MTM0MC8yNzgyMQ==">-->
    <!--            <script type="text/javascript">-->
    <!--                (function (d, s) {-->
    <!--                    var j, e = d.getElementsByTagName(s)[0];-->

    <!--                    if (typeof LivereTower === 'function') {-->
    <!--                        return;-->
    <!--                    }-->

    <!--                    j = d.createElement(s);-->
    <!--                    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';-->
    <!--                    j.async = true;-->

    <!--                    e.parentNode.insertBefore(j, e);-->
    <!--                })(document, 'script');-->
    <!--            </script>-->
    <!--            <noscript>라이브리 댓글 작성을 위해 JavaScript를 활성화 해주세요</noscript>-->
    <!--        </div>-->
    <!--        &lt;!&ndash; 시티 설치 코드 끝 &ndash;&gt;-->
    <!--    </div>-->


    <script>
        $("#btn-delete").click(function (e) {

            Swal.fire({
                title: '게시글을 삭제하시겠습니까?',
                icon: 'warning',

                showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
                confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
                cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
                confirmButtonText: '예', // confirm 버튼 텍스트 지정
                cancelButtonText: '아니요', // cancel 버튼 텍스트 지정

            }).then(result => {
                // 만약 Promise리턴을 받으면,
                if (result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면
                    Swal.fire('게시글이 삭제되었습니다', '', 'success')
                            .then(() => {
                                $.ajax({
                                    type: "POST",
                                    url: "/post/delete/{{model.postId}}",

                                }).done((res) => {
                                    // alert("Ddd");
                                    window.location.href = "/post/list";

                                }).fail((res) => {
                                    alert("실패");
                                });

                            });
                }
            });
        });

    </script>

{{>/layout/footer}}