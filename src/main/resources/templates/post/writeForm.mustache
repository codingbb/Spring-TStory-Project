{{>/layout/main-header}}

<style>
    .ql-editor {
        min-height: 40vh;
    }
</style>
<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>


<div class="container">
    <form id="postWriteForm" onsubmit="return getQuill()">
        <div class="form-group">
            <select class="form-control" id="categoryId" name="categoryId">
                {{#model.categoryNameDTO}}
                    <option value="{{id}}">{{categoryName}}</option>
                {{/model.categoryNameDTO}}
            </select>
        </div>

        <input id="title" name="title" class="form-control" type="text" placeholder="Enter Title">

        <!--        퀼 에디터 디자인 부분 -->
        <div id="toolbarContainer">
            <span class="ql-formats">
                <select class="ql-font"></select>
                <select class="ql-size"></select>
            </span>
            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
                <button class="ql-strike"></button>
            </span>
            <span class="ql-formats">
                <select class="ql-color"></select>
                <select class="ql-background"></select>
            </span>
            <span class="ql-formats">
                <button class="ql-script" value="sub"></button>
                <button class="ql-script" value="super"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-header" value="1"></button>
                <button class="ql-header" value="2"></button>
                <button class="ql-blockquote"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-list" value="ordered"></button>
                <button class="ql-list" value="bullet"></button>
                <button class="ql-indent" value="-1"></button>
                <button class="ql-indent" value="+1"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-direction" value="rtl"></button>
                <select class="ql-align"></select>
            </span>
            <span class="ql-formats">
                <button class="ql-link"></button>
                <button class="ql-image"></button>
                <button class="ql-video"></button>
            </span>
            <span class="ql-formats">
                <button class="ql-clean"></button>
            </span>
        </div>
        <!--        퀼 에디터 디자인 부분-->

        <!-- 내용 적는 부분 form 데이터로 통으로 넣자 -->
        <div id="editorContainer"></div>
        <!-- 내용 적는 부분 -->

        <div class="form-control d-flex justify-content-end">
            <div>섬네일 사진 등록 : <input id="thumbnailFile" type="file" name="thumbnailFile"></div>
        </div>
        <button type="submit" class="my_active_btn">글쓰기 등록</button>
    </form>
    <br/>

</div>



<script>

    $("#postWriteForm").on("submit", function (e) {
       e.preventDefault();

       let formData = new FormData();

       let title = $("#title").val();
       console.log("제목 " + title);

       let categoryId = $("#categoryId").val();
       console.log("categoryId " + categoryId);

       // <div id="editorContainer"></div> 이 부분 가져오기
        let content = $("#editorContainer").find(".ql-editor").text();
        console.log("content " + content);

        // 섬네일
        let thumbnailFile = $("#thumbnailFile")[0].files[0];
        console.log("thumbnailFile " + thumbnailFile);

        formData.append('title', title);
        formData.append('content', content);
        formData.append('categoryId', categoryId);
        formData.append('thumbnailFile', thumbnailFile);


        $.ajax({
            url: "/post/save",
            data: formData,
            contentType: false,
            processData: false,
            type: 'POST'

        }).done((res)=>{
            swal({
                text: "게시글 등록이 완료되었습니다.",
                icon: "success",
                button: "확인"
            });

            window.location.href = "/post/list";

        }).fail((res)=>{
            swal({
                text: "게시글 등록 실패",
                icon: "warning",
                button: "확인"
            });
        });

    });


<!--    퀼 에디터 -->
    function getQuill() {
        let quillContent = $("#editorContainer .ql-editor").html();
        $("#content").html(quillContent);
        return true;
    }

    var quill = new Quill('#editorContainer', {
        modules: {
            formula: true,
            syntax: true,
            toolbar: '#toolbarContainer'
        },
        placeholder: '게시물을 작성해주세요.',
        theme: 'snow'
    });
// 퀼 에디터 끝

</script>


{{>/layout/footer}}