{{>/layout/main-header}}

<div class="container">
    <div class="my_auth_box">
        <div class="my_auth_form_box">
            <div class="my_auth_form_box_title">JSotry</div>
            <div class="my_error_box my_hidden">

            </div>
            <form action="/join" method="post" id="joinForm">
                <input id="username" class="my_auth_form_box_input" type="text" name="username" placeholder="유저네임"
                    maxlength="20" value="ssar1" required />
                <div id="usernameExist" class="my_hidden" style="color: red">중복된 아이디입니다.</div>
                <div id="usernameNoExist" class="my_hidden" style="color: green">사용 가능한 아이디입니다.</div>

                <input id="password" class="my_auth_form_box_input" type="password" name="password" placeholder="비밀번호"
                    maxlength="20" value="1234" required />

                <input id="same-password" class="my_auth_form_box_input" type="password" name="" placeholder="비밀번호 확인"
                    maxlength="20" value="1234" required />
                <div id="nameCheckFalse" style="color: red">비밀번호가 일치하지 않습니다.</div>
                <div id="nameCheckTrue" style="color: green">비밀번호가 일치합니다.</div>

                <input class="my_auth_form_box_input" type="email" name="email" placeholder="이메일" maxlength="60"
                    value="ssar1@nate.com" required />
                <button type="submit" id="joinBtn" class="my_secondary_btn">회원가입</button>
            </form>
            <div class="my_auth_form_box_link">
                <div><a href="/login-form">로그인</a></div>
                <div><a href="/user/password-reset-form">비밀번호 찾기</a></div>
            </div>
        </div>
    </div>
    <br />
</div>

<script>
<!--    username 중복 체크 -->
$("#username").on("keyup", _.debounce(function() {
    console.log($(this).val());
    let username = $(this).val();

    $.ajax({
        url: '/username-check',
        data: {username: username},
        type: 'GET'

    }).done((res) => {
        console.log("Res " + JSON.stringify(res));

        if (res.body === "USER_EXIST") {
            $("#usernameExist").removeClass("my_hidden");
            $("#usernameNoExist").addClass("my_hidden")
        }

        if (res.body === "USER_NO_EXIST") {
            $("#usernameExist").addClass("my_hidden");
            $("#usernameNoExist").removeClass("my_hidden");
        }

        if ((username) === "") {
            $("#usernameNoExist").addClass("my_hidden");
            $("#usernameExist").addClass("my_hidden");
        }

    }).fail((res) => {
        alert("오류");
    });

}, 500));

// username 중복 체크 끝


<!--    비밀번호 동일 체크 -->
    $("#nameCheckFalse").addClass("my_hidden");
    $("#nameCheckTrue").addClass("my_hidden");

    $("#same-password").on("input", function () {
        let password = $("#password").val();
        // console.log("패스워드 = " + password);

        let confirmPassword = $("#same-password").val();
        // console.log("확인용 = " + confirmPassword);

        if (password === confirmPassword) {
            $("#nameCheckTrue").removeClass("my_hidden");
            $("#nameCheckFalse").addClass("my_hidden");
            $("#joinBtn").css("background-color", "green");

            // 값을 다 지웠으면 다시 둘 다 my_hidden 넣어줘야함
        } else if (confirmPassword === "") {
            $("#nameCheckFalse").addClass("my_hidden");
            $("#nameCheckTrue").addClass("my_hidden");
            $("#joinBtn").css("background-color", "");

        }else {
            $("#nameCheckFalse").removeClass("my_hidden");
            $("#nameCheckTrue").addClass("my_hidden");
            $("#joinBtn").css("background-color", "");
        }
    });
    // 비밀번호 동일체크 끝


    // 비번이 다르면 form 제출 못하게 막아놓음
    $("#joinForm").on("submit", function (e) {
        let password = $("#password").val();
        // console.log("패스워드 = " + password);

        let confirmPassword = $("#same-password").val();
        // console.log("확인용 = " + confirmPassword);

        if (password !== confirmPassword) {
            e.preventDefault();

            swal({
                text: "비밀번호를 확인해주세요",
                icon: "warning",
                button: "확인"
            });

        } else if (confirmPassword === "") {
            e.preventDefault();

            swal({
                text: "비밀번호를 확인해주세요",
                icon: "warning",
                button: "확인"
            });
        }
    });
// 비번이 다르면 form 제출 못하게 막아놓음

</script>


{{>/layout/footer}}